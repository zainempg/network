<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NetworkModuleBuilder.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">network</a> &gt; <a href="index.source.html" class="el_package">com.dubizzle.network.builder</a> &gt; <span class="el_source">NetworkModuleBuilder.kt</span></div><h1>NetworkModuleBuilder.kt</h1><pre class="source lang-java linenums">package com.dubizzle.network.builder

import okhttp3.Authenticator
import okhttp3.Cache
import okhttp3.CookieJar
import okhttp3.OkHttpClient
import retrofit2.CallAdapter
import retrofit2.Converter
import retrofit2.Retrofit
import java.util.concurrent.TimeUnit

/**
 * A builder class for creating and configuring a Retrofit instance.
 *
 * This class provides a fluent API for adding various components to the Retrofit instance,
 * such as interceptors, converters, call adapters, and network configurations.
 *
 * Usage:
 * ```
 * val retrofit = NetworkModuleBuilder()
 *     .addInterceptor(HttpLoggingInterceptor().apply { level = HttpLoggingInterceptor.Level.BODY })
 *     .addConverterFactory(GsonConverterFactory.create())
 *     .buildRetrofit(&quot;https://api.example.com/&quot;)
 * ```
 */
<span class="nc" id="L26">class NetworkModuleBuilder {</span>
    /**
     * The builder for the OkHttpClient used for network requests.
     *
     * This builder can be customized to configure various aspects of the HTTP client,
     * such as timeouts, interceptors, and caching.
     *
     * By default, it's initialized with a basic OkHttpClient.Builder instance.
     * You can access and modify this builder to apply your custom settings.
     */
<span class="nc" id="L36">    private var okHttpClientBuilder: OkHttpClient.Builder = OkHttpClient.Builder()</span>

    /**
     * A list of [CallAdapter.Factory] instances used to create call adapters.
     *
     * Call adapters adapt the return type of the service interface methods to the expected type.
     * This allows using different return types like `Flow`, `Deferred`, etc. instead of `Call`.
     *
     * This list is initialized as an empty ArrayList. Call adapters can be added to this list
     * using the `addCallAdapterFactory` method.
     */
<span class="nc" id="L47">    private val callAdapterFactory = arrayListOf&lt;CallAdapter.Factory&gt;()</span>

    /**
     * A list of [Converter.Factory] instances used to create call adapters.
     *
     * Call adapters are responsible for converting the return type of a Retrofit service method
     * into a [Call] object which can be executed to make the network request.
     *
     * This list can be modified to add or remove custom call adapter factories.
     */
<span class="nc" id="L57">    private val callConverterFactory = arrayListOf&lt;Converter.Factory&gt;()</span>

    /**
     * Adds a [CookieJar] to the OkHttpClient being built.
     *
     * This allows the network client to automatically manage cookies for requests and responses.
     *
     * @param cookieJar The [CookieJar] to use for managing cookies.
     * @return The [NetworkModuleBuilder] instance for chaining method calls.
     */
    fun addCookieJar(cookieJar: CookieJar): NetworkModuleBuilder {
<span class="nc" id="L68">        okHttpClientBuilder = okHttpClientBuilder.cookieJar(cookieJar)</span>
<span class="nc" id="L69">        return this</span>
    }

    /**
     * Adds an [Authenticator] to the OkHttpClient being built.
     *
     * The authenticator is used to automatically re-authenticate requests
     * when a 401 (Unauthorized) response is received.
     *
     * @param authInterceptor The [Authenticator] to be added.
     * @return This [NetworkModuleBuilder] instance for chaining calls.
     */
    fun authenticator(authInterceptor: Authenticator): NetworkModuleBuilder {
<span class="nc" id="L82">        okHttpClientBuilder = okHttpClientBuilder.authenticator(authInterceptor)</span>
<span class="nc" id="L83">        return this</span>
    }

    /**
     * Adds a network interceptor to the OkHttpClient.
     *
     * Network interceptors are invoked for every network request, regardless of whether it is served from the cache.
     * This allows them to monitor, rewrite, and retry calls. They have access to both the request and response.
     *
     * **Note:** Unlike application interceptors, network interceptors do not have access to request body for POST requests that are cached.
     *
     * @param interceptor The [okhttp3.Interceptor] instance to add.
     * @return This NetworkModuleBuilder instance to facilitate method chaining.
     */
    fun addNetworkInterceptor(interceptor: okhttp3.Interceptor): NetworkModuleBuilder {
<span class="nc" id="L98">        okHttpClientBuilder = okHttpClientBuilder.addNetworkInterceptor(interceptor)</span>
<span class="nc" id="L99">        return this</span>
    }

    /**
     * Adds an interceptor to the OkHttpClient builder.
     *
     * Interceptors are a powerful mechanism that can monitor, rewrite, and retry calls.
     * They are called in the order they are added.
     *
     * @param interceptor The interceptor to add.
     * @return This NetworkModuleBuilder instance for method chaining.
     */
    fun addInterceptor(interceptor: okhttp3.Interceptor): NetworkModuleBuilder {
<span class="nc" id="L112">        okHttpClientBuilder = okHttpClientBuilder.addInterceptor(interceptor)</span>
<span class="nc" id="L113">        return this</span>
    }

    /**
     * Adds a [CallAdapter.Factory] to the list of call adapter factories used by Retrofit.
     *
     * Call adapter factories are responsible for adapting the return type of a Retrofit service method
     * to a type that can be used by the calling code. For example, a call adapter factory might be used
     * to adapt a `Call&lt;T&gt;` to a `Flow&lt;T&gt;` or a `Deferred&lt;T&gt;`.
     *
     * @param callAdapterFactory The call adapter factory to add.
     * @return This builder instance, allowing for chaining of method calls.
     */
    fun addCallAdapterFactory(callAdapterFactory: CallAdapter.Factory): NetworkModuleBuilder {
<span class="nc" id="L127">        this.callAdapterFactory.add(callAdapterFactory)</span>
<span class="nc" id="L128">        return this</span>
    }

    /**
     * Adds a [Converter.Factory] to the list of converter factories used by Retrofit.
     *
     * Converter factories are responsible for converting HTTP responses into Java objects
     * and vice versa. This method allows you to add custom converter factories to handle
     * specific data formats or serialization libraries.
     *
     * @param converterFactory The [Converter.Factory] to add.
     * @return This [NetworkModuleBuilder] instance to allow for method chaining.
     */
    fun addConverterFactory(converterFactory: Converter.Factory): NetworkModuleBuilder {
<span class="nc" id="L142">        this.callConverterFactory.add(converterFactory)</span>
<span class="nc" id="L143">        return this</span>
    }

    /**
     * Builds a Retrofit instance using the provided base URL and pre-configured
     * OkHttp client, call adapter factories, and call converter factories.
     *
     * @param stringUrl The base URL for the API endpoints.
     * @return A configured Retrofit instance ready to create API services.
     */
    fun buildRetrofit(stringUrl: String): Retrofit {
<span class="nc" id="L154">        return Retrofit.Builder()</span>
<span class="nc" id="L155">            .baseUrl(stringUrl)</span>
<span class="nc" id="L156">            .client(okHttpClientBuilder.build()).apply {</span>
<span class="nc" id="L157">                callAdapterFactory.forEach { this.addCallAdapterFactory(it) }</span>
<span class="nc" id="L158">                callConverterFactory.forEach { this.addConverterFactory(it) }</span>
<span class="nc" id="L159">            }.build()</span>
    }

    /**
     * Configures the [OkHttpClient] to use the provided [Cache] for caching network responses.
     *
     * This function allows you to specify a custom cache implementation for your network requests.
     * The cache will be used to store and retrieve responses, potentially reducing network traffic
     * and improving performance.
     *
     * @param cache The [Cache] instance to use for caching.
     * @return This [NetworkModuleBuilder] instance, allowing for method chaining.
     */
    fun cache(cache: Cache): NetworkModuleBuilder {
<span class="nc" id="L173">        okHttpClientBuilder = okHttpClientBuilder.cache(cache)</span>
<span class="nc" id="L174">        return this</span>
    }

    /**
     * Sets the call timeout for the OkHttpClient.
     *
     * This function configures the maximum time allowed for the entire HTTP call to complete,
     * including connection establishment, request transmission, and response reception.
     *
     * @param i The timeout duration.
     * @param unit The time unit for the timeout duration (e.g., TimeUnit.SECONDS).
     * @return This NetworkModuleBuilder instance for method chaining.
     */
    fun callTimeout(i: Long, unit: TimeUnit): NetworkModuleBuilder {
<span class="nc" id="L188">        okHttpClientBuilder = okHttpClientBuilder.callTimeout(i, unit)</span>
<span class="nc" id="L189">        return this</span>
    }

    /**
     * Sets the connect timeout for the OkHttpClient.
     *
     * @param i The timeout value.
     * @param unit The unit of the timeout value.
     * @return This NetworkModuleBuilder instance to allow for chaining of calls.
     */
    fun connectTimeout(i: Long, unit: TimeUnit): NetworkModuleBuilder {
<span class="nc" id="L200">        okHttpClientBuilder = okHttpClientBuilder.connectTimeout(i, unit)</span>
<span class="nc" id="L201">        return this</span>
    }

    /**
     * Sets the read timeout for the OkHttpClient.
     *
     * This function configures the maximum time allowed for reading data from the server.
     * If the read operation takes longer than the specified timeout, a SocketTimeoutException will be thrown.
     *
     * @param i The timeout value.
     * @param unit The time unit of the timeout value.
     * @return This NetworkModuleBuilder instance, allowing for chained method calls.
     */
    fun readTimeout(i: Long, unit: TimeUnit): NetworkModuleBuilder {
<span class="nc" id="L215">        okHttpClientBuilder = okHttpClientBuilder.readTimeout(i, unit)</span>
<span class="nc" id="L216">        return this</span>
    }

    /**
     * Sets the write timeout for the OkHttpClient.
     *
     * This function configures the maximum time allowed for writing data to the server.
     * If the write operation takes longer than the specified timeout, a SocketTimeoutException will be thrown.
     *
     * @param i The timeout value.
     * @param unit The time unit of the timeout value (e.g., TimeUnit.SECONDS).
     * @return This NetworkModuleBuilder instance, allowing for chained calls.
     */
    fun writeTimeout(i: Long, unit: TimeUnit): NetworkModuleBuilder {
<span class="nc" id="L230">        okHttpClientBuilder = okHttpClientBuilder.writeTimeout(i, unit)</span>
<span class="nc" id="L231">        return this</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>